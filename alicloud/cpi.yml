---
- type: replace
  path: /releases/-
  value:
    name: bosh-alicloud-cpi
    #version: 65
    url: file:///root/downloads/bosh-alicloud-cpi-0+dev.9.tgz
    #sha1: 26b3a5c43e6f82594a373309a495660d6db26254

# light stemcell
- type: replace
  path: /resource_pools/name=vms/stemcell?
  value:
    url: http://bosh-alicloud.oss-cn-hangzhou.aliyuncs.com/light-bosh-stemcell-1008-alicloud-kvm-ubuntu-trusty-go_agent.tgz
    sha1: fd23369acfb1b6c3a712d9abb7b32637cdca7763

# Configure Alibaba sizes
- type: replace
  path: /resource_pools/name=vms/cloud_properties?
  value:
    instance_type: ecs.mn4.large
    instance_charge_type: PostPaid
    instance_name: bosh-director
    system_disk: {size: 51_200, type: cloud_efficiency}
    ephemeral_disk: {size: 51_200, type: cloud_efficiency}
    instance_role: ""
    availability_zone: ((az))

- type: replace
  path: /disk_pools/name=disks/cloud_properties?
  value:
    type: "cloud_efficiency"
    instance_role: "director"

- type: replace
  path: /networks/name=default/subnets/0/cloud_properties?
  value:
    security_group_id: ((security_group_id))
    vswitch_id: ((subnet_id))
    internet_charge_type: PayByTraffic

# Enable registry job
- type: replace
  path: /instance_groups/name=bosh/jobs/-
  value:
    name: registry
    release: bosh

- type: replace
  path: /instance_groups/name=bosh/properties/registry?
  value: &registry
    address: ((internal_ip))
    host: ((internal_ip))
    db: # todo *db
      host: 127.0.0.1
      listen_address: 127.0.0.1
      user: postgres
      password: ((postgres_password))
      database: bosh
      adapter: postgres
    http:
      user: registry
      password: ((registry_password))
      port: 25777
    username: registry
    password: ((registry_password))
    password: admin
    port: 25777

#- type: replace
#  path: /instance_groups/name=bosh/properties/blobstore?
#  value: &blobstore
#    address: ((internal_ip))
#    port: 25250
#    provider: dav
#    director:
#      user: director
#      # password: ((blobstore_director_password))
#      password: director-password
#    agent:
#      user: agent
#      # password: ((blobstore_agent_password))
#      password: agent-password

# Add CPI job
- type: replace
  path: /instance_groups/name=bosh/jobs/-
  value: &cpi_job
    name: alicloud_cpi
    release: bosh-alicloud-cpi

- type: replace
  path: /instance_groups/name=bosh/properties/director/cpi_job?
  value: alicloud_cpi

- type: replace
  path: /cloud_provider/template?
  value: *cpi_job

- type: replace
  path: /instance_groups/name=bosh/properties/alicloud?
  value: &alicloud
    region_id: ((region))
    access_key_id: ((access_key_id))
    access_key_secret: ((access_key_secret))

- type: replace
  path: /cloud_provider/properties/alicloud?
  value: *alicloud

- type: replace
  path: /variables/-
  value:
    name: registry_password
    type: password
